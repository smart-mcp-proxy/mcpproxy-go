# Worktree: Zero-Config OAuth Implementation

**Branch**: `zero-config-oauth`
**Based on**: `origin/oauth-diagnostics-phase0`
**Created**: 2025-11-27

## Purpose

Implement zero-config OAuth with automatic RFC 8707 resource parameter detection.

## Base Branch Features (Inherited from Phase 0)

This worktree includes Phase 0 OAuth diagnostics infrastructure:

✅ **OAuth Error Parsing** - `OAuthParameterError` type
✅ **Config Serialization** - `ExtraParams` in contracts
✅ **Enhanced Diagnostics** - `auth status` and `doctor` commands
✅ **Test Coverage** - OAuth error parsing tests

## Implementation Plan

See: `docs/plans/2025-11-27-zero-config-oauth.md`

### Phase 1: Resource Parameter Extraction (Week 1)
- [ ] Enhance `internal/oauth/discovery.go` - Add `DiscoverProtectedResourceMetadata()`
- [ ] Update `internal/oauth/config.go` - Extract resource parameter
- [ ] Add resource fallback logic
- [ ] Return `(OAuthConfig, extraParams)` tuple
- [ ] Add unit tests

### Phase 2: OAuth Wrapper (Week 1-2)
- [ ] Create `internal/oauth/wrapper.go`
- [ ] Implement URL interception
- [ ] Wire up in `tryOAuthAuth()`
- [ ] Test with Runlayer

### Phase 3: Capability Detection (Week 2)
- [ ] Add `IsOAuthCapable()` function
- [ ] Update `auth status` to use new function
- [ ] Update `doctor` to use new function

## Quick Commands

```bash
# Build
go build -o mcpproxy ./cmd/mcpproxy

# Run tests
go test ./internal/oauth/... -v

# Test with Runlayer
./mcpproxy auth status
./mcpproxy doctor
```

## Documentation

- **Implementation Plan**: `docs/plans/2025-11-27-zero-config-oauth.md`
- **Branch Strategy**: `docs/plans/branch-strategy-zero-config-oauth.md`
- **Research**: `docs/oauth-auto-detection-analysis.md`
- **Feasibility**: `docs/zero-config-oauth-analysis.md`

## Git Commands

```bash
# View base commits
git log --oneline -10

# Compare with main
git log main..HEAD --oneline

# Push branch
git push -u origin zero-config-oauth

# Create PR (when ready)
gh pr create --base main --title "feat: zero-config OAuth with auto-detection" \
  --body "Implements automatic RFC 8707 resource parameter detection. See docs/plans/2025-11-27-zero-config-oauth.md"
```

## Notes

- Based on `oauth-diagnostics-phase0` for 45% code reuse
- Inherits OAuth error handling infrastructure
- Focus on net-new features (resource extraction + wrapper)
